# Player Execution Flow Analysis

## ğŸ“Š System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          FRONTEND (JavaScript)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  player.html                                                            â”‚
â”‚  â”œâ”€ common.js (WebSocket/REST routing)                                 â”‚
â”‚  â”œâ”€ player.js (UI controls)                                            â”‚
â”‚  â””â”€ websocket-preview.js (video preview)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  HTTP/WebSocket   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BACKEND (Python)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  rest_api.py (Flask + SocketIO)                                        â”‚
â”‚  â”œâ”€ REST endpoints (/api/player/*)                                     â”‚
â”‚  â”œâ”€ WebSocket namespaces (/player, /effects, /layers, /video)         â”‚
â”‚  â””â”€ Command routing                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  player_manager.py (Orchestrator)                                      â”‚
â”‚  â”œâ”€ Master/Slave synchronization                                       â”‚
â”‚  â”œâ”€ Player lifecycle management                                        â”‚
â”‚  â””â”€ Event propagation (clip changes)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  video  â”‚  artnet  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  player.py (Individual Player Instance)                                â”‚
â”‚  â”œâ”€ Playback thread (_play_loop)                                       â”‚
â”‚  â”œâ”€ Multi-layer rendering                                              â”‚
â”‚  â”œâ”€ Effect pipeline                                                    â”‚
â”‚  â”œâ”€ Transition system                                                  â”‚
â”‚  â””â”€ Frame source management                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  frame_source.py                                                        â”‚
â”‚  â”œâ”€ VideoSource (OpenCV)                                               â”‚
â”‚  â””â”€ GeneratorSource (Plugin system)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ® Play Command Flow (Normal Mode)

### 1. User Clicks "Play" Button

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: player.js                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  User clicks play button â†’ window.play(playerId)                        â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. executeCommand() (hybrid router in common.js)                  â”‚ â”‚
â”‚  â”‚    â”œâ”€ WEBSOCKET_COMMANDS_ENABLED = true?                          â”‚ â”‚
â”‚  â”‚    â”‚  â””â”€ Try WebSocket /player namespace first                    â”‚ â”‚
â”‚  â”‚    â”‚     â”œâ”€ playerSocket.emit('command.play', {player_id})        â”‚ â”‚
â”‚  â”‚    â”‚     â”œâ”€ Wait for response (timeout: 1000ms)                   â”‚ â”‚
â”‚  â”‚    â”‚     â””â”€ Success â†’ Return                                      â”‚ â”‚
â”‚  â”‚    â”‚                                                               â”‚ â”‚
â”‚  â”‚    â””â”€ WebSocket failed/timeout?                                   â”‚ â”‚
â”‚  â”‚       â””â”€ Fallback to REST API                                     â”‚ â”‚
â”‚  â”‚          â””â”€ fetch('POST /api/player/play')                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  Timing: ~5-10ms (WebSocket) OR ~20-50ms (REST)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Socket.IO / HTTP
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: rest_api.py                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 2. WebSocket Handler: handle_play(data)                           â”‚ â”‚
â”‚  â”‚    â”œâ”€ Extract player_id from data                                 â”‚ â”‚
â”‚  â”‚    â”œâ”€ Get player from player_manager                              â”‚ â”‚
â”‚  â”‚    â”œâ”€ Call player.play()                                          â”‚ â”‚
â”‚  â”‚    â”œâ”€ emit('command.response', {success: True})                   â”‚ â”‚
â”‚  â”‚    â””â”€ Broadcast status to all clients                             â”‚ â”‚
â”‚  â”‚       â””â”€ socketio.emit('player.status', namespace='/player')      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  Timing: ~1-2ms                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Python call
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: player.py                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 3. player.play()                                                   â”‚ â”‚
â”‚  â”‚    â”œâ”€ is_playing check â†’ already playing? return                  â”‚ â”‚
â”‚  â”‚    â”œâ”€ is_paused check                                             â”‚ â”‚
â”‚  â”‚    â”‚  â”œâ”€ True â†’ resume()                                          â”‚ â”‚
â”‚  â”‚    â”‚  â””â”€ False â†’ start()                                          â”‚ â”‚
â”‚  â”‚    â”‚                                                               â”‚ â”‚
â”‚  â”‚    â””â”€ player.start() flow:                                        â”‚ â”‚
â”‚  â”‚       â”œâ”€ Check if Art-Net enabled                                 â”‚ â”‚
â”‚  â”‚       â”‚  â””â”€ Register as active Art-Net player (stop old player)   â”‚ â”‚
â”‚  â”‚       â”œâ”€ Source.initialize() - prepare video/generator            â”‚ â”‚
â”‚  â”‚       â”œâ”€ artnet_manager.is_active = True                          â”‚ â”‚
â”‚  â”‚       â”œâ”€ Set flags: is_playing=True, is_running=True              â”‚ â”‚
â”‚  â”‚       â”œâ”€ Source.reset() - seek to beginning                       â”‚ â”‚
â”‚  â”‚       â””â”€ START NEW THREAD: _play_loop() (daemon)                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  Timing: ~5-20ms (thread creation + initialization)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ New Thread
                                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND: player.py - _play_loop() Thread                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 4. MAIN PLAYBACK LOOP (runs until is_running=False)               â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚    while is_running:                                               â”‚ â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚       â”‚ A. FRAME ACQUISITION (Multi-Layer)                      â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”œâ”€ Layer 0 (Master): source.get_next_frame()         â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â”œâ”€ VideoSource: cv2.read()                        â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â””â”€ GeneratorSource: plugin.generate_frame()       â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â””â”€ Layers 1-N (Overlays):                            â”‚ â”‚ â”‚
â”‚  â”‚       â”‚       â”œâ”€ For each layer:                                â”‚ â”‚ â”‚
â”‚  â”‚       â”‚       â”‚  â”œâ”€ Get frame from layer.source                 â”‚ â”‚ â”‚
â”‚  â”‚       â”‚       â”‚  â”œâ”€ Apply layer effects                         â”‚ â”‚ â”‚
â”‚  â”‚       â”‚       â”‚  â””â”€ Composite with blend mode + opacity         â”‚ â”‚ â”‚
â”‚  â”‚       â”‚       â”‚     â””â”€ BlendEffect.process_frame()              â”‚ â”‚ â”‚
â”‚  â”‚       â”‚       â”‚                                                  â”‚ â”‚ â”‚
â”‚  â”‚       â”‚       â””â”€ Result: Composited multi-layer frame           â”‚ â”‚ â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚       â”‚                                                             â”‚ â”‚
â”‚  â”‚       â”‚ Timing per frame: ~2-10ms (depends on layers & effects)    â”‚ â”‚
â”‚  â”‚       â†“                                                             â”‚ â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚       â”‚ B. FRAME = None HANDLING (End of Clip)                  â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”œâ”€ Check if player is SLAVE                          â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â””â”€ is_slave = (player_manager.master_playlist !=  â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚                 None AND not is_master())           â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”œâ”€ If SLAVE:                                         â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â”œâ”€ Loop current clip (source.seek(0))            â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â”œâ”€ DON'T advance to next clip                     â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â””â”€ Wait for master sync event                     â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”œâ”€ If NOT SLAVE && autoplay enabled:                â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â”œâ”€ Load next playlist item                        â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â”œâ”€ Initialize new source                          â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â”œâ”€ Update current_clip_index                      â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â””â”€ NOTIFY MANAGER:                                â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚     player_manager.on_clip_changed(player_id,      â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚                                     clip_index)     â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚                                                     â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â””â”€ Else: Stop playback                               â”‚ â”‚ â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚       â”‚                                                             â”‚ â”‚
â”‚  â”‚       â”‚ Timing: Immediate (loop) or 10-50ms (next clip load)       â”‚ â”‚
â”‚  â”‚       â†“                                                             â”‚ â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚       â”‚ C. EFFECT PIPELINE                                      â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”œâ”€ apply_brightness(frame)                           â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”œâ”€ For each clip effect:                             â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â””â”€ effect_plugin.process_frame(frame)             â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â””â”€ apply_transition(frame) if active                 â”‚ â”‚ â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚       â”‚                                                             â”‚ â”‚
â”‚  â”‚       â”‚ Timing: ~1-5ms per effect                                  â”‚ â”‚
â”‚  â”‚       â†“                                                             â”‚ â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚       â”‚ D. OUTPUT                                               â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”œâ”€ Store in output_buffer (for preview)              â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”œâ”€ Send to DMX (if Art-Net enabled)                  â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â”‚  â””â”€ dmx_controller.update_from_frame(frame)        â”‚ â”‚ â”‚
â”‚  â”‚       â”‚    â””â”€ FPS limiting (sleep to match target FPS)          â”‚ â”‚ â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚       â”‚                                                             â”‚ â”‚
â”‚  â”‚       â”‚ Timing: ~1-20ms (DMX + sleep)                              â”‚ â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚  â”‚                                                                    â”‚ â”‚
â”‚  â”‚    Total Loop Iteration: ~16-50ms (depends on FPS target & load)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘‘ Master/Slave Mode - Clip Synchronization Flow

### Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MASTER/SLAVE ARCHITECTURE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  FRONTEND: User clicks Master Toggle                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  POST /api/playlists/master                                      â”‚
    â”‚  { "player_id": "video" }  or  { "player_id": null }             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  PLAYER_MANAGER: set_master_playlist(player_id)                  â”‚
    â”‚                                                                   â”‚
    â”‚  1. Store: self.master_playlist = "video" (or None)              â”‚
    â”‚  2. If activating master (not None):                             â”‚
    â”‚     â”œâ”€ Force master to index 0                                   â”‚
    â”‚     â”‚  â””â”€ master_player.load_clip_by_index(0, notify=False)     â”‚
    â”‚     â””â”€ Initial sync: sync_slaves_to_master()                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  PLAYER_MANAGER: sync_slaves_to_master()                         â”‚
    â”‚                                                                   â”‚
    â”‚  1. Get master player's current_clip_index (e.g., 0)             â”‚
    â”‚  2. For each player (video, artnet):                             â”‚
    â”‚     â”œâ”€ Skip if player is master                                  â”‚
    â”‚     â””â”€ _sync_slave_to_index(slave_player, 0)                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  PLAYER_MANAGER: _sync_slave_to_index(slave, index)              â”‚
    â”‚                                                                   â”‚
    â”‚  Edge Cases:                                                     â”‚
    â”‚  â”œâ”€ Slave has empty playlist â†’ Skip                              â”‚
    â”‚  â”œâ”€ Index >= slave.playlist length â†’ slave.stop()                â”‚
    â”‚  â””â”€ Valid index:                                                 â”‚
    â”‚     â””â”€ slave_player.load_clip_by_index(index, notify=False)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SLAVE PLAYER: load_clip_by_index(index, notify_manager=False)   â”‚
    â”‚                                                                   â”‚
    â”‚  1. Stop current playback if running                             â”‚
    â”‚  2. Load new clip from playlist[index]                           â”‚
    â”‚  3. Initialize source (VideoSource or GeneratorSource)           â”‚
    â”‚  4. Update: self.current_clip_index = index                      â”‚
    â”‚  5. Start transition if enabled                                  â”‚
    â”‚  6. Restart playback (player.start())                            â”‚
    â”‚  7. Skip notification (notify_manager=False to avoid loop)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Result: All slaves now playing same clip index as master
```

### Timeline: Master Clip Change Event

```
Time   Master Player          Player Manager          Slave Player(s)
â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
t=0    Playing clip index 2                          Playing clip index 2
â”‚      (Autoplay enabled)
â”‚
â”‚      ... clip 2 ends ...
â”‚      Frame = None
â†“
t+1    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Autoplay Logic  â”‚
       â”‚ Load clip 3     â”‚
       â”‚ current_clip_   â”‚
       â”‚   index = 3     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ notify_manager=True
                â†“
t+2            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ on_clip_changed(     â”‚
               â”‚   player_id="video"  â”‚
               â”‚   clip_index=3       â”‚
               â”‚ )                    â”‚
               â”‚                      â”‚
               â”‚ Check: is master?    â”‚
               â”‚ YES â†’ Sync slaves!   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ For each slave
                         â†“
t+3                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ _sync_slave_to_index(   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   slave="artnet",       â”‚â”€â”€â”€â†’â”‚ ARTNET SLAVE â”‚
                        â”‚   clip_index=3          â”‚    â”‚              â”‚
                        â”‚ )                       â”‚    â”‚ Stop clip 2  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ Load clip 3  â”‚
                                                       â”‚ Start()      â”‚
t+4                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       Now playing 
                                                       clip index 3

Total Sync Latency: ~2-50ms (depends on clip initialization time)
```

### Slave Behavior in Play Loop

```python
# In player.py _play_loop() - when frame = None (clip ended)

if frame is None:
    # Check if this player is a slave
    is_slave = (self.player_manager and 
                self.player_manager.master_playlist is not None and 
                not self.player_manager.is_master(self.player_id))
    
    if is_slave:
        # SLAVE MODE: Loop current clip, DON'T autoplay next
        logger.debug(f"ğŸ”„ Slave mode: Looping current clip (index {self.playlist_index})")
        current_source = self.layers[0].source if self.layers else self.source
        if current_source and hasattr(current_source, 'seek'):
            current_source.seek(0)  # Reset to beginning
        self.current_loop = 0
        continue  # Stay in loop, don't advance playlist
    
    # NOT SLAVE: Normal autoplay behavior
    if self.autoplay and len(self.playlist) > 0:
        next_index = self.playlist_index + 1
        # ... load next clip ...
        # Notify manager (will trigger slave sync if this is master)
        if self.player_manager:
            self.player_manager.on_clip_changed(self.player_id, next_index)
```

**Key Point**: Slaves loop their current clip endlessly until master tells them to switch. This prevents slaves from advancing independently.

---

## ğŸ¬ Complete Play Flow with Master/Slave

```
USER ACTION: Click Play on Video Player (Master enabled)
â”‚
â”œâ”€â†’ FRONTEND: executeCommand('player', 'command.play', {player_id: 'video'})
â”‚   â””â”€â†’ WebSocket: emit to /player namespace (~5ms)
â”‚
â”œâ”€â†’ BACKEND: rest_api.py handle_play()
â”‚   â”œâ”€â†’ player_manager.get_player('video')
â”‚   â””â”€â†’ video_player.play() (~10ms)
â”‚
â”œâ”€â†’ BACKEND: player.py start()
â”‚   â”œâ”€â†’ Register as active Art-Net player (if enabled)
â”‚   â”œâ”€â†’ Initialize source
â”‚   â”œâ”€â†’ Set is_playing = True
â”‚   â””â”€â†’ Create thread: _play_loop()
â”‚
â””â”€â†’ BACKEND: player.py _play_loop() [NEW THREAD]
    â”‚
    â”œâ”€â†’ FRAME ACQUISITION
    â”‚   â”œâ”€ Layer 0: source.get_next_frame() (~2-5ms)
    â”‚   â””â”€ Layers 1-N: composite with blend effects (~1-3ms per layer)
    â”‚
    â”œâ”€â†’ EFFECT PIPELINE
    â”‚   â”œâ”€ Brightness adjustment (~0.5ms)
    â”‚   â”œâ”€ Clip effects (plugin.process_frame()) (~1-5ms each)
    â”‚   â””â”€ Transition effect if active (~2-10ms)
    â”‚
    â”œâ”€â†’ OUTPUT
    â”‚   â”œâ”€ Store in output_buffer (preview) (~0.1ms)
    â”‚   â”œâ”€ Send to DMX/Art-Net (~5-15ms)
    â”‚   â””â”€ FPS limiting sleep (~16ms for 60fps)
    â”‚
    â””â”€â†’ CLIP END DETECTION (frame = None)
        â”‚
        â”œâ”€â†’ Check: is_slave?
        â”‚   â”œâ”€ YES: Loop current clip (seek to 0)
        â”‚   â””â”€ NO: Continue to autoplay check
        â”‚
        â”œâ”€â†’ Autoplay enabled?
        â”‚   â”œâ”€ YES: Load next clip
        â”‚   â”‚   â”œâ”€ playlist_index += 1
        â”‚   â”‚   â”œâ”€ Initialize new source (~10-30ms)
        â”‚   â”‚   â”œâ”€ current_clip_index = playlist_index
        â”‚   â”‚   â””â”€â†’ NOTIFY MANAGER:
        â”‚   â”‚       player_manager.on_clip_changed('video', new_index)
        â”‚   â”‚       â”‚
        â”‚   â”‚       â””â”€â†’ PLAYER_MANAGER checks: is 'video' master?
        â”‚   â”‚           â”œâ”€ YES: Trigger slave sync!
        â”‚   â”‚           â”‚   â””â”€â†’ For each slave:
        â”‚   â”‚           â”‚       â”œâ”€ artnet_player.load_clip_by_index(new_index)
        â”‚   â”‚           â”‚       â”‚   â”œâ”€ Stop current playback
        â”‚   â”‚           â”‚       â”‚   â”œâ”€ Load clip from playlist[new_index]
        â”‚   â”‚           â”‚       â”‚   â”œâ”€ Initialize source (~10-30ms)
        â”‚   â”‚           â”‚       â”‚   â””â”€ Start playback
        â”‚   â”‚           â”‚       â””â”€ Slave now synchronized!
        â”‚   â”‚           â”‚
        â”‚   â”‚           â””â”€ NO: No action (slave doesn't trigger sync)
        â”‚   â”‚
        â”‚   â””â”€ NO: Stop playback
        â”‚
        â””â”€â†’ Loop continues...
```

---

## âš¡ WebSocket Command Channels - Latency Breakdown

### Command Path Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REST API Command (Old Method)                          Total: ~30-60msâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Button click                                                  0ms  â”‚
â”‚ 2. JavaScript fetch() call                                      2ms  â”‚
â”‚ 3. HTTP request over network                                    5ms  â”‚
â”‚ 4. Flask routing + CORS handling                                3ms  â”‚
â”‚ 5. Backend processing (player.play())                          10ms  â”‚
â”‚ 6. HTTP response generation                                     2ms  â”‚
â”‚ 7. Network return                                               5ms  â”‚
â”‚ 8. JavaScript promise resolution                                2ms  â”‚
â”‚ 9. UI update polling (wait for next status broadcast)       3000ms  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WebSocket Command (New Method)                         Total: ~8-20ms â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Button click                                                  0ms  â”‚
â”‚ 2. executeCommand() routing check                               0.5msâ”‚
â”‚ 3. playerSocket.emit() - already connected                      1ms  â”‚
â”‚ 4. WebSocket binary frame transmission                          2ms  â”‚
â”‚ 5. SocketIO routing to /player namespace                        1ms  â”‚
â”‚ 6. Backend processing (player.play())                          10ms  â”‚
â”‚ 7. emit('command.response') back to client                      2ms  â”‚
â”‚ 8. Status broadcast to all clients (instant)                    2ms  â”‚
â”‚ 9. UI updates immediately from broadcast                        0ms  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Improvement: 96% faster (3000ms â†’ 18ms for UI update)
```

### WebSocket Namespaces

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /player namespace - Transport Controls                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Events:                                                             â”‚
â”‚ â”œâ”€ command.play     â†’ player.play()                                â”‚
â”‚ â”œâ”€ command.pause    â†’ player.pause()                               â”‚
â”‚ â”œâ”€ command.stop     â†’ player.stop()                                â”‚
â”‚ â”œâ”€ command.next     â†’ player.next_clip()                           â”‚
â”‚ â””â”€ command.previous â†’ player.previous_clip()                       â”‚
â”‚                                                                     â”‚
â”‚ Broadcasts:                                                         â”‚
â”‚ â””â”€ player.status    â†’ {is_playing, is_paused, ...}                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /effects namespace - Effect Parameters                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Events:                                                             â”‚
â”‚ â””â”€ effect.update_param â†’ update effect parameter in real-time      â”‚
â”‚                           (e.g., blur intensity slider)             â”‚
â”‚                                                                     â”‚
â”‚ Features:                                                           â”‚
â”‚ â”œâ”€ Debounced updates (50ms) to reduce traffic                      â”‚
â”‚ â”œâ”€ 3-tier backend update method:                                   â”‚
â”‚ â”‚  1. effect.set_parameter(name, value)                            â”‚
â”‚ â”‚  2. effect.parameters[name] = value                              â”‚
â”‚ â”‚  3. setattr(effect, name, value)                                 â”‚
â”‚ â””â”€ Immediate visual feedback (< 100ms total latency)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /layers namespace - Multi-Layer Controls                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Events:                                                             â”‚
â”‚ â”œâ”€ layer.update_opacity    â†’ layer.opacity = value (0.0 - 1.0)     â”‚
â”‚ â””â”€ layer.update_blend_mode â†’ layer.blend_mode = 'normal/add/...'   â”‚
â”‚                                                                     â”‚
â”‚ Features:                                                           â”‚
â”‚ â”œâ”€ Debounced updates (50ms) for smooth slider dragging             â”‚
â”‚ â””â”€ Real-time compositing updates                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /video namespace - Video Streaming                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Events:                                                             â”‚
â”‚ â”œâ”€ connect         â†’ Client requests video stream                  â”‚
â”‚ â”œâ”€ start_stream    â†’ {player_id, quality, fps}                     â”‚
â”‚ â”œâ”€ stop_stream     â†’ Stop streaming                                â”‚
â”‚ â””â”€ change_quality  â†’ Switch quality preset                         â”‚
â”‚                                                                     â”‚
â”‚ Streaming:                                                          â”‚
â”‚ â”œâ”€ Binary frame data sent via emit('frame', binary_data)           â”‚
â”‚ â”œâ”€ JPEG compression (quality: low/medium/high)                     â”‚
â”‚ â”œâ”€ Frame identity tracking (skip duplicate frames)                 â”‚
â”‚ â””â”€ Canvas rendering with aspect ratio preservation                 â”‚
â”‚                                                                     â”‚
â”‚ Performance:                                                        â”‚
â”‚ â”œâ”€ Latency: < 100ms (frame acquisition â†’ display)                  â”‚
â”‚ â”œâ”€ Poll interval: 1ms (minimal CPU impact)                         â”‚
â”‚ â””â”€ Automatic fallback to MJPEG if WebSocket fails                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Effect Parameter Update Flow (WebSocket)

```
USER ACTION: Drag slider for blur intensity
â”‚
â”œâ”€â†’ FRONTEND: player.js updateParameter()
â”‚   â”œâ”€ Debounce timer (50ms) - prevents spam
â”‚   â””â”€ After debounce: sendParameterUpdate()
â”‚       â”‚
â”‚       â”œâ”€â†’ Check WEBSOCKET_COMMANDS_ENABLED
â”‚       â”‚   â””â”€ YES: executeCommand('effects', 'effect.update_param', {
â”‚       â”‚              clip_id, effect_id, param_name, value
â”‚       â”‚          })
â”‚       â”‚
â”‚       â””â”€â†’ effectsSocket.emit('effect.update_param', data)
â”‚
â”œâ”€â†’ BACKEND: rest_api.py handle_effect_param_update()
â”‚   â”œâ”€ Get clip from clip_registry (by clip_id)
â”‚   â”œâ”€ Find effect instance (by effect_id)
â”‚   â””â”€ Update parameter (3-tier method):
â”‚       â”‚
â”‚       â”œâ”€ Try: effect.set_parameter(name, value)
â”‚       â”œâ”€ Fallback: effect.parameters[name] = value
â”‚       â””â”€ Fallback: setattr(effect, name, value)
â”‚
â””â”€â†’ RESULT: Next frame in _play_loop() uses updated parameter
    â”‚
    â””â”€ Effect pipeline applies new value immediately
       â”œâ”€ effect.process_frame(frame) with new parameter
       â””â”€ Output buffer updated with affected frame
           â””â”€ WebSocket video stream sends updated frame to client
               â””â”€ User sees blur intensity change on canvas

Total Latency: ~50ms (debounce) + ~20ms (WebSocket + processing) + 
               ~16ms (next frame) = ~86ms (imperceptible)
```

---

## ğŸ“Š Performance Metrics

### Typical Operation Times

| Operation | Time (ms) | Notes |
|-----------|-----------|-------|
| WebSocket emit (client â†’ server) | 1-2 | Binary protocol, persistent connection |
| REST API request | 5-10 | HTTP overhead, new connection |
| player.play() execution | 5-20 | Thread creation, source initialization |
| Frame acquisition (video) | 2-5 | OpenCV read from disk/RAM |
| Frame acquisition (generator) | 1-10 | Depends on plugin complexity |
| Single effect processing | 1-5 | NumPy operations on frame |
| Multi-layer composite (3 layers) | 5-15 | Multiple blends + opacity |
| DMX/Art-Net transmission | 5-15 | Network packet, 512 channels |
| Transition effect | 2-10 | Alpha blending calculation |
| Clip switch (load new source) | 10-50 | File I/O, codec initialization |
| Master â†’ Slave sync | 2-50 | Depends on clip initialization |

### Frame Rates

```
Target FPS: 30-60 (configurable)
Frame Budget: 16.67ms (60fps) or 33.33ms (30fps)

Typical Frame Processing Time:
â”œâ”€ Minimal setup (1 layer, no effects): ~8ms   â†’ 120 fps possible
â”œâ”€ Standard setup (3 layers, 2 effects): ~25ms â†’ 40 fps possible
â””â”€ Heavy setup (5 layers, 5 effects): ~50ms    â†’ 20 fps possible

Bottlenecks:
1. OpenCV video decoding (~2-5ms per frame)
2. NumPy array operations for effects (~1-3ms per effect)
3. Art-Net network transmission (~5-15ms)
4. Hard disk I/O for video files (minimize with SSD)
```

---

## ğŸ¯ Key Timing Considerations

### Master/Slave Synchronization

1. **Initial Sync** (when master activated):
   - Master jumps to index 0: ~10-30ms
   - Slaves sync to index 0: ~10-30ms per slave
   - Total: ~20-60ms until all players aligned

2. **Runtime Sync** (master clip change):
   - Master clip ends, loads next: ~10-50ms
   - on_clip_changed() notification: ~0.1ms
   - Slave receives sync, loads clip: ~10-50ms
   - **Sync window**: ~20-100ms (slaves may start slightly behind master)

3. **Slave Loop Behavior**:
   - When clip ends and is slave: seek(0) + reset (~5ms)
   - Slave keeps looping until master advances
   - No network dependency during loop (local operation)

### WebSocket vs REST Comparison

| Metric | REST API | WebSocket | Improvement |
|--------|----------|-----------|-------------|
| Connection Setup | Per request (~5ms) | Once (~10ms initial) | N/A |
| Command Latency | 20-50ms | 5-10ms | 3-5x faster |
| UI Update Delay | 0-3000ms (polling) | <5ms (broadcast) | 600x faster |
| Parameter Updates | 1 per request | Batched/debounced | More efficient |
| Network Overhead | HTTP headers (~500 bytes) | Binary frame (~10 bytes) | 50x less |

### Effect Pipeline Latency

```
User moves slider â†’ Frontend debounce (50ms) â†’ 
WebSocket emit (2ms) â†’ Backend update (1ms) â†’
Wait for next frame (0-16ms at 60fps) â†’
Effect applied to frame (2ms) â†’
Frame sent via WebSocket (2ms) â†’
Canvas render (1ms) â†’
User sees result

Total: ~58-74ms (feels instantaneous)
```

---

## ğŸš€ Optimization Strategies

### Current Optimizations

1. **WebSocket Persistent Connections**: Eliminates HTTP handshake overhead
2. **Frame Identity Tracking**: Skip sending duplicate frames (video paused)
3. **Debounced Parameter Updates**: Reduce traffic during slider drag (50ms)
4. **Multi-Threaded Playback**: _play_loop() runs in separate thread
5. **NumPy Vectorization**: Effect processing uses optimized array operations
6. **Lazy Source Initialization**: Only initialize when actually needed
7. **Blend Effect Caching**: Pre-compute blend LUTs where possible

### Potential Bottlenecks

1. **Hard Disk I/O**: Use SSD, pre-load clips into RAM
2. **Network Latency**: Local network = ~1ms, Internet = ~20-100ms
3. **CPU-Heavy Effects**: Consider GPU acceleration (OpenGL/Vulkan)
4. **Large Playlists**: Clip loading time scales with file size
5. **Simultaneous Slaves**: Each slave adds ~10-30ms to sync time

### Future Improvements

1. **Frame Buffer Pool**: Pre-allocate NumPy arrays to reduce GC
2. **GPU Acceleration**: Move effect pipeline to GPU shaders
3. **Clip Pre-Loading**: Load next playlist clip in background
4. **Binary Protocol**: Replace JSON with MessagePack for WebSocket
5. **Multi-Process Rendering**: Separate process per player for true parallelism

---

## ğŸ“ Summary

### Critical Execution Paths

1. **Play Command**: Frontend (5ms) â†’ WebSocket (2ms) â†’ Backend (10ms) â†’ Thread Start (5ms) = **22ms**

2. **Frame Rendering**: Acquisition (5ms) â†’ Effects (5ms) â†’ Output (20ms) â†’ FPS limit (16ms) = **46ms** (60fps OK)

3. **Master Sync**: Clip End (0ms) â†’ Notify (0.1ms) â†’ Load Slave Clip (30ms) â†’ Start (5ms) = **35ms**

4. **Parameter Update**: Debounce (50ms) â†’ WebSocket (2ms) â†’ Update (1ms) â†’ Next Frame (16ms) = **69ms**

### Order of Operations (Master/Slave)

```
1. User activates master (video)
   â””â”€â†’ Master jumps to index 0
       â””â”€â†’ All slaves sync to index 0
           â””â”€â†’ System ready (all players at index 0)

2. User clicks play on master
   â””â”€â†’ Master starts _play_loop()
       â””â”€â†’ Renders frames with effects
           â””â”€â†’ Sends to Art-Net + preview
               â””â”€â†’ Clip ends (frame = None)
                   â””â”€â†’ Autoplay loads next clip (index 1)
                       â””â”€â†’ on_clip_changed() event
                           â””â”€â†’ All slaves receive sync
                               â””â”€â†’ Slaves load clip index 1
                                   â””â”€â†’ Slaves start playing index 1
                                       â””â”€â†’ System synchronized

3. Slave reaches end of clip before master
   â””â”€â†’ Slave loops current clip (seek 0)
       â””â”€â†’ Waits for master sync event
           â””â”€â†’ Master eventually advances
               â””â”€â†’ Slave receives sync, loads next clip
```

This flow ensures slaves never advance independently, maintaining perfect playlist synchronization with the master.
