<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Output Settings</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link href="libs/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="css/output-settings.css">
</head>
<body>
    <script src="js/menu-loader.js"></script>
    
    <!-- Modal Component (must load before session-manager) -->
    <script src="js/modal-loader.js"></script>
    
    <!-- Session Management (depends on modal) -->
    <script src="js/session-manager.js"></script>
    
    <script src="js/toast-loader.js"></script>
    
    <!-- Session State Manager -->
    <script src="js/session-state-manager.js" defer></script>
    
    <div class="container">
        <!-- Left Panel -->
        <div class="left-panel" id="leftPanel">
            <div class="panel-toggle" onclick="app.togglePanel('left')" title="Toggle Panel">‚óÄ</div>
            
            <!-- Mode Switcher -->
            <div class="panel-section" id="modeSwitcherSection" style="flex: 0 0 auto; padding: 12px; background: #1a1a1a; border-bottom: 1px solid #333;">
                <div class="mode-toggle">
                    <div class="mode-btn active" onclick="app.setMode('video')" id="modeVideoBtn">
                        üé¨ Video Output
                    </div>
                    <div class="mode-btn" onclick="app.setMode('artnet')" id="modeArtNetBtn">
                        üí° ArtNet Output
                    </div>
                </div>
            </div>
            
            <div class="panel-section" id="canvasSection">
                <h2>‚öôÔ∏è Canvas</h2>
                <div class="panel-section-content">
                    <div class="input-row">
                        <div class="input-group">
                            <label>Width</label>
                            <input type="number" id="canvasWidth" value="1920" readonly title="Set resolution via player context menu (right-click video preview)">
                        </div>
                        <div class="input-group">
                            <label>Height</label>
                            <input type="number" id="canvasHeight" value="1080" readonly title="Set resolution via player context menu (right-click video preview)">
                        </div>
                    </div>
                    <small style="color: #888; font-size: 11px; padding: 4px 8px; display: block;">üí° Change resolution via player context menu</small>
                </div>
            </div>

            <div class="panel-section" id="toolsSection">
                <h2>üõ†Ô∏è Tools</h2>
                <div class="panel-section-content">
                <div class="type-toggle">
                    <div class="type-btn slice active" onclick="app.setType('slice')" id="typeSliceBtn">
                        ‚ñ≠ Slice
                    </div>
                    <div class="type-btn mask" onclick="app.setType('mask')" id="typeMaskBtn">
                        ‚óê Mask
                    </div>
                </div>
                <div id="maskWarning" style="display: none; font-size: 11px; color: #ff9800; padding: 8px; background: #3a2a1a; border-radius: 4px; margin: 10px 0;">
                    ‚ö†Ô∏è Select a slice first to add masks
                </div>

                <div id="shapeTypeSection" style="display: none;">
                    <div style="font-size: 11px; color: #999; margin: 10px 0;">Shape Type:</div>
                    <div class="shape-tools">
                        <button class="shape-btn active" onclick="app.setShape('rectangle')" id="shapeRectangleBtn" title="Rectangle">‚ñ≠</button>
                        <button class="shape-btn" onclick="app.setShape('circle')" id="shapeCircleBtn" title="Circle">‚óã</button>
                        <button class="shape-btn" onclick="app.setShape('triangle')" id="shapeTriangleBtn" title="Triangle">‚ñ≥</button>
                        <button class="shape-btn" onclick="app.setShape('polygon')" id="shapePolygonBtn" title="Polygon">‚¨°</button>
                        <button class="shape-btn" onclick="app.setShape('freehand')" id="shapeFreehandBtn" title="Freehand">‚úèÔ∏è</button>
                    </div>
                </div>

                <div style="display: flex; gap: 8px; flex-direction: column;">
                    <button class="primary" onclick="app.startDrawing()" id="addShapeBtn">‚ûï Add Rectangle</button>
                    <button onclick="app.finishDrawing()" id="finishDrawBtn" style="display: none; background: #4CAF50;">‚úì Finish</button>
                    <button onclick="app.cancelDrawing()" id="cancelDrawBtn" style="display: none;">‚úï Cancel</button>
                    <button onclick="app.deleteSelected()">üóëÔ∏è Delete</button>
                    <button onclick="app.toggleSnap()" id="snapBtn">üìê Snap: OFF</button>
                    <button onclick="app.toggleTransformMode()" id="transformBtn">üîß Transform</button>
                    <button onclick="app.deleteTransform()" id="deleteTransformBtn">üîÑ Delete Transform</button>
                </div>
                </div>
            </div>

            <div class="panel-section" id="outputsSection">
                <h2>üñ•Ô∏è Outputs</h2>
                <div class="panel-section-content">
                <div id="screenButtonsContainer" style="display: flex; gap: 6px; flex-direction: column;">
                    <!-- Output list generated by JavaScript -->
                </div>
                <button class="primary" onclick="app.addOutput()" style="margin-top: 10px; width: 100%;">‚ûï Add Output</button>
                </div>
            </div>
            
            <!-- ArtNet Outputs Section (only visible in ArtNet mode) -->
            <div class="panel-section" id="artnetOutputsSection" style="display: none;">
                <h2>üí° ArtNet Outputs</h2>
                <div class="panel-section-content">
                <div id="artnetOutputsContainer" style="display: flex; gap: 6px; flex-direction: column;">
                    <!-- ArtNet output list generated by JavaScript -->
                </div>
                <button class="primary" onclick="app.addArtNetOutput()" style="margin-top: 10px; width: 100%;">‚ûï Add ArtNet Output</button>
                </div>
            </div>
        </div>

        <!-- Center Panel -->
        <div class="canvas-panel">
            <div class="canvas-header">
                <div class="canvas-info">
                    <div>Canvas: <strong id="canvasDimensions">1920x1080</strong></div>
                    <div>Mouse: <strong id="mousePosition">--, --</strong></div>
                    <div>Selected: <strong id="selectedObjectName">None</strong></div>
                    <div id="artnetToolbar" style="margin-left: auto; display: none;">
                        <button class="toolbar-btn" onclick="app.toggleColorPreview()" id="toggleColorPreviewBtn" style="font-size: 11px; padding: 4px 8px; margin: 2px;">Color Preview</button>
                        <button class="toolbar-btn" onclick="app.toggleGrid()" id="toggleGridBtn" style="font-size: 11px; padding: 4px 8px; margin: 2px;">Grid</button>
                        <button class="toolbar-btn" onclick="app.togglePointIds()" id="togglePointIdsBtn" style="font-size: 11px; padding: 4px 8px; margin: 2px;">Point IDs</button>
                        <button class="toolbar-btn" onclick="app.toggleUniverseBounds()" id="toggleUniverseBoundsBtn" style="font-size: 11px; padding: 4px 8px; margin: 2px;">Universe Bounds</button>
                        <button class="toolbar-btn" onclick="app.toggleColoredOutlines()" id="toggleColoredOutlinesBtn" style="font-size: 11px; padding: 4px 8px; margin: 2px;">Colored Outlines</button>
                        <button class="toolbar-btn" onclick="app.toggleObjectNames()" id="toggleObjectNamesBtn" style="font-size: 11px; padding: 4px 8px; margin: 2px;">Object Names</button>
                        <button class="toolbar-btn" onclick="app.toggleBoundingBox()" id="toggleBoundingBoxBtn" style="font-size: 11px; padding: 4px 8px; margin: 2px;">Bounding Box</button>
                    </div>
                </div>
            </div>

            <div class="canvas-wrapper" id="canvasWrapper">
                <div id="canvasContainer">
                    <img id="videoStream" style="position: absolute; width: 100%; height: 100%; object-fit: contain; z-index: 1; pointer-events: none; user-select: none;" src="/api/preview/stream" alt="Video Stream" draggable="false">
                    <canvas id="videoCanvas" style="position: absolute; top: 0; left: 0; z-index: 1; display: none;"></canvas>
                    <canvas id="sliceCanvas" style="position: absolute; top: 0; left: 0; z-index: 2;"></canvas>
                </div>
                <div class="zoom-controls">
                    <button onclick="window.app.zoomOut()" title="Zoom Out">‚àí</button>
                    <div class="zoom-level" id="zoomLevel">100%</div>
                    <button onclick="window.app.zoomIn()" title="Zoom In">+</button>
                    <button onclick="window.app.resetZoom()" title="Reset Zoom" style="font-size: 12px;">1:1</button>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel" id="rightPanel">
            <div class="panel-toggle" onclick="app.togglePanel('right')" title="Toggle Panel" style="left: 10px; right: auto;">‚ñ∂</div>
            
            <!-- Video Mode Sections -->
            <div id="videoModeSections">
            <div class="slices-list">
                <h2>‚ó´ Slices (<span id="sliceCount">0</span>)</h2>
                <div id="slicesList"></div>
            </div>

            <div class="panel-section" id="backendSyncSection">
                <div class="panel-section-content">
                    <div id="backendStatus" style="font-size: 11px; color: #888; padding: 8px; background: #1a1a1a; border-radius: 4px;">
                        <strong>Backend:</strong> <span id="backendStatusText">Not connected</span><br>
                        <span id="monitorCount" style="display: none;">Monitors: <strong id="monitorCountNum">0</strong></span>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <div class="panel-section-content">
                    <button onclick="app.clearAll()" class="danger" style="width: 100%;">üóëÔ∏è Clear All</button>
                </div>
            </div>
            </div>
            
            <!-- ArtNet Mode Sections (only visible in ArtNet mode) -->
            <div id="artnetModeSections" style="display: none;">
                <div class="panel-section">
                    <h2>üí° ArtNet Objects (<span id="artnetObjectCount">0</span>)</h2>
                    <div id="artnetObjectsList" style="max-height: 300px; overflow-y: auto; padding: 8px;">
                        <!-- ArtNet objects list generated by JavaScript -->
                    </div>
                </div>
                
                <div class="panel-section" id="artnetPropertiesSection">
                    <h2>‚öôÔ∏è Object Properties</h2>
                    <div class="panel-section-content" id="artnetProperties">
                        <div id="artnetPropertiesPlaceholder" style="font-size: 12px; color: #888; padding: 12px; text-align: center;">
                            Select an object to edit properties
                        </div>
                        <div id="artnetPropertiesForm" style="display: none;">
                            <!-- Object properties form -->
                            <div class="input-row" style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-size: 12px;">Object Name</label>
                                <input type="text" id="artnetObjName" style="width: 100%; padding: 6px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0;">
                            </div>

                            <!-- Transform Controls -->
                            <div style="border: 1px solid #333; border-radius: 4px; padding: 10px; margin-bottom: 12px; background: #0d0d0d;">
                                <label style="display: block; margin-bottom: 8px; font-size: 12px; font-weight: bold; color: #4CAF50;">Transform</label>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 2px; font-size: 11px; color: #aaa;">Position X</label>
                                        <input type="number" id="artnetTransformX" onchange="app.updateArtNetTransform('x')" style="width: 100%; padding: 4px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0; font-size: 12px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 2px; font-size: 11px; color: #aaa;">Position Y</label>
                                        <input type="number" id="artnetTransformY" onchange="app.updateArtNetTransform('y')" style="width: 100%; padding: 4px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0; font-size: 12px;">
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 2px; font-size: 11px; color: #aaa;">Rotation ¬∞</label>
                                        <input type="number" id="artnetTransformRotation" step="1" onchange="app.updateArtNetTransform('rotation')" style="width: 100%; padding: 4px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0; font-size: 12px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 2px; font-size: 11px; color: #aaa;">Scale X</label>
                                        <input type="number" id="artnetTransformScaleX" step="0.01" onchange="app.updateArtNetTransform('scaleX')" style="width: 100%; padding: 4px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0; font-size: 12px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 2px; font-size: 11px; color: #aaa;">Scale Y</label>
                                        <input type="number" id="artnetTransformScaleY" step="0.01" onchange="app.updateArtNetTransform('scaleY')" style="width: 100%; padding: 4px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0; font-size: 12px;">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="input-row" style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-size: 12px;">LED Type</label>
                                <select id="artnetLedType" onchange="app.updateArtNetProperty('led_type')" style="width: 100%; padding: 6px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0;">
                                    <option value="RGB">RGB (3 channels)</option>
                                    <option value="RGBW">RGBW (4 channels)</option>
                                    <option value="RGBAW">RGBAW (5 channels)</option>
                                </select>
                            </div>
                            
                            <div class="input-row" style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-size: 12px;">Channel Order</label>
                                <select id="artnetChannelOrder" onchange="app.updateArtNetProperty('channel_order')" style="width: 100%; padding: 6px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0;">
                                    <option value="RGB">RGB</option>
                                    <option value="RBG">RBG</option>
                                    <option value="GRB">GRB</option>
                                    <option value="GBR">GBR</option>
                                    <option value="BRG">BRG</option>
                                    <option value="BGR">BGR</option>
                                </select>
                            </div>
                            
                            <div class="input-row" style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-size: 12px;">Delay (ms)</label>
                                <input type="number" id="artnetDelay" min="0" max="1000" value="0" onchange="app.updateArtNetProperty('delay')" style="width: 100%; padding: 6px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0;">
                            </div>
                            
                            <div class="input-row" id="whiteDetectionRow" style="margin-bottom: 12px; display: none;">
                                <label style="display: flex; align-items: center; font-size: 12px; cursor: pointer;">
                                    <input type="checkbox" id="artnetWhiteDetection" onchange="app.updateArtNetProperty('white_detection_enabled')" style="margin-right: 6px;">
                                    White Channel Detection
                                </label>
                                <small style="color: #888; font-size: 11px; display: block; margin-top: 4px;">
                                    Automatically detect white pixels and route to W/A channel
                                </small>
                            </div>
                            
                            <div class="input-row" style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-size: 12px;">Brightness</label>
                                <input type="range" id="artnetBrightness" min="0" max="100" value="100" oninput="app.updateSliderDisplay('brightness')" onchange="app.updateArtNetProperty('brightness')" style="width: 100%;">
                                <span id="artnetBrightnessValue" style="font-size: 11px; color: #888;">100%</span>
                            </div>
                            
                            <div class="input-row" style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-size: 12px;">Contrast</label>
                                <input type="range" id="artnetContrast" min="0" max="100" value="100" oninput="app.updateSliderDisplay('contrast')" onchange="app.updateArtNetProperty('contrast')" style="width: 100%;">
                                <span id="artnetContrastValue" style="font-size: 11px; color: #888;">100%</span>
                            </div>
                            
                            <div class="input-row" style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 8px; font-size: 12px;">Color Correction</label>
                                <div style="display: flex; gap: 8px; flex-direction: column;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 11px; width: 15px;">R</span>
                                        <input type="range" id="artnetColorR" min="0" max="200" value="100" oninput="app.updateSliderDisplay('color_correction')" onchange="app.updateArtNetProperty('color_correction')" style="flex: 1;">
                                        <span id="artnetColorRValue" style="font-size: 11px; color: #888; width: 35px;">100%</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 11px; width: 15px;">G</span>
                                        <input type="range" id="artnetColorG" min="0" max="200" value="100" oninput="app.updateSliderDisplay('color_correction')" onchange="app.updateArtNetProperty('color_correction')" style="flex: 1;">
                                        <span id="artnetColorGValue" style="font-size: 11px; color: #888; width: 35px;">100%</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 11px; width: 15px;">B</span>
                                        <input type="range" id="artnetColorB" min="0" max="200" value="100" oninput="app.updateSliderDisplay('color_correction')" onchange="app.updateArtNetProperty('color_correction')" style="flex: 1;">
                                        <span id="artnetColorBValue" style="font-size: 11px; color: #888; width: 35px;">100%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="input-row" style="margin-bottom: 12px;">
                                <label style="display: block; margin-bottom: 4px; font-size: 12px;">Assign to Output</label>
                                <select id="artnetOutputAssignment" onchange="app.assignArtNetObjectToOutput()" style="width: 100%; padding: 6px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0;">
                                    <option value="">None</option>
                                    <!-- Populated by JavaScript -->
                                </select>
                            </div>
                            
                            <div class="input-row" style="margin-bottom: 12px;">
                                <label style="display: flex; align-items: center; font-size: 12px; cursor: pointer;">
                                    <input type="checkbox" id="artnetIsSlave" onchange="app.toggleSlaveMode()" style="margin-right: 6px;">
                                    Is Slave
                                </label>
                                <small style="color: #888; font-size: 11px; display: block; margin-top: 4px;">
                                    Link this object to copy settings from a master
                                </small>
                            </div>
                            
                            <div id="artnetMasterRow" class="input-row" style="margin-bottom: 12px; display: none;">
                                <label style="display: block; margin-bottom: 4px; font-size: 12px;">Master Object</label>
                                <select id="artnetMasterObject" onchange="app.updateArtNetProperty('master_id')" style="width: 100%; padding: 6px; background: #1a1a1a; border: 1px solid #333; border-radius: 3px; color: #e0e0e0;">
                                    <option value="">Select Master...</option>
                                    <!-- Populated by JavaScript -->
                                </select>
                            </div>
                            
                            <div class="input-row">
                                <button onclick="app.deleteArtNetObject()" class="danger" style="width: 100%;">üóëÔ∏è Delete Object</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="panel-section-content">
                        <button onclick="app.syncArtNetObjects()" class="primary" style="width: 100%; margin-bottom: 8px;">üîÑ Sync from Editor</button>
                        <button onclick="app.clearArtNetObjects()" class="danger" style="width: 100%;">üóëÔ∏è Clear All Objects</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DMX Monitor Modal (ArtNet mode) -->
    <div id="dmxMonitorModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; background: #1a1a1a; padding: 20px; border-radius: 6px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">DMX Monitor - Output Preview</h3>
                <button onclick="app.closeDmxMonitor()" style="background: none; border: none; color: #999; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px;">√ó</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 16px; display: flex; gap: 12px; align-items: center;">
                    <label style="font-size: 13px;">Universe:</label>
                    <select id="dmxUniverseSelect" onchange="app.changeDmxUniverse()" style="padding: 6px 12px; background: #252525; border: 1px solid #3a3a3a; border-radius: 3px; color: #e0e0e0; font-size: 13px;">
                        <!-- Populated dynamically -->
                    </select>
                    <button onclick="app.sendTestPattern()" style="padding: 6px 12px; background: #0d47a1; color: #fff; border: none; border-radius: 3px; cursor: pointer; font-size: 13px;">Send Test Pattern</button>
                    <span id="dmxStats" style="margin-left: auto; font-size: 12px; color: #888;"></span>
                </div>
                <div id="dmxChannelGrid" style="display: grid; grid-template-columns: repeat(32, 1fr); gap: 2px; font-family: monospace; font-size: 10px;">
                    <!-- 512 channels in 16 rows √ó 32 cols -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add ArtNet Output Modal -->
    <div id="addOutputModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px; background: #1a1a1a; padding: 20px; border-radius: 6px;">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 id="outputModalTitle" style="margin: 0;">‚ûï Add ArtNet Output</h3>
                <button onclick="app.closeAddOutputModal()" style="background: none; border: none; color: #999; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px;">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editOutputId" value="">
                <div class="input-row" style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 4px; font-size: 12px;">Output Name</label>
                    <input type="text" id="newOutputName" placeholder="e.g., Main LED Strip" style="width: 100%; padding: 8px; background: #252525; border: 1px solid #3a3a3a; border-radius: 3px; color: #e0e0e0;">
                </div>
                
                <div class="input-row" style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 4px; font-size: 12px;">Target IP Address</label>
                    <input type="text" id="newOutputIP" value="127.0.0.1" placeholder="e.g., 192.168.1.100" style="width: 100%; padding: 8px; background: #252525; border: 1px solid #3a3a3a; border-radius: 3px; color: #e0e0e0;">
                </div>
                
                <div class="input-row" style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 4px; font-size: 12px;">Subnet Mask</label>
                    <input type="text" id="newOutputSubnet" value="255.255.255.0" style="width: 100%; padding: 8px; background: #252525; border: 1px solid #3a3a3a; border-radius: 3px; color: #e0e0e0;">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                    <div class="input-row">
                        <label style="display: block; margin-bottom: 4px; font-size: 12px;">Start Universe</label>
                        <input type="number" id="newOutputUniverse" value="0" min="0" max="32767" style="width: 100%; padding: 8px; background: #252525; border: 1px solid #3a3a3a; border-radius: 3px; color: #e0e0e0;">
                    </div>
                    
                    <div class="input-row">
                        <label style="display: block; margin-bottom: 4px; font-size: 12px;">FPS</label>
                        <input type="number" id="newOutputFPS" value="40" min="1" max="120" style="width: 100%; padding: 8px; background: #252525; border: 1px solid #3a3a3a; border-radius: 3px; color: #e0e0e0;">
                    </div>
                </div>
                
                <div class="input-row" style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 4px; font-size: 12px;">Delay (ms)</label>
                    <input type="number" id="newOutputDelay" value="0" min="0" max="1000" style="width: 100%; padding: 8px; background: #252525; border: 1px solid #3a3a3a; border-radius: 3px; color: #e0e0e0;">
                </div>
                
                <div class="input-row" style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 12px; cursor: pointer;">
                        <input type="checkbox" id="newOutputArtSync" checked style="cursor: pointer;">
                        <span>Enable ArtSync (timing synchronization)</span>
                    </label>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="app.closeAddOutputModal()" style="padding: 8px 16px; background: #333; color: #e0e0e0; border: none; border-radius: 3px; cursor: pointer;">Cancel</button>
                    <button id="outputModalSaveBtn" onclick="app.saveNewArtNetOutput()" style="padding: 8px 16px; background: #0d47a1; color: #fff; border: none; border-radius: 3px; cursor: pointer;">Create Output</button>
                </div>
            </div>
        </div>
    </div>

    <div id="contextMenu" class="context-menu">
        <!-- Video Mode Context Menu Items -->
        <div class="video-context-items">
        <div class="context-menu-item" onclick="app.contextMenuAction('centerX', event)">üìç Center X</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('centerY', event)">üìç Center Y</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="app.contextMenuAction('alignCenter', event)">‚äô Align Center</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('alignLeft', event)">‚á§ Align Left</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('alignRight', event)">‚á• Align Right</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('alignTop', event)">‚áß Align Top</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('alignBottom', event)">‚á© Align Bottom</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="app.contextMenuAction('leftHalf', event)">‚óß Left Half</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('rightHalf', event)">‚ó® Right Half</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('topHalf', event)">‚¨í Top Half</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('bottomHalf', event)">‚¨ì Bottom Half</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('wholeArea', event)">‚¨ú Whole Area</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="app.contextMenuAction('ratio16_9', event)">üìê Set 16:9 (by height)</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="app.contextMenuAction('preview', event)">üîç Preview Slice</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('duplicate', event)">üìã Duplicate</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('delete', event)">üóëÔ∏è Delete</div>
        </div>
        
        <!-- ArtNet Mode Context Menu Items -->
        <div class="artnet-context-items" style="display: none;">
        <div class="context-menu-item" onclick="app.contextMenuAction('previewOutput', event)">üîç Preview Output</div>
        <div class="context-menu-item" onclick="app.contextMenuAction('selectObject', event)">üëÜ Select Object</div>
        </div>
        
        <!-- Mask Context Menu Items -->
        <div class="mask-context-items" style="display: none;">
        <div class="context-menu-item" onclick="app.contextMenuAction('invertMask', event)">‚ö™ Invert Mask</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="app.contextMenuAction('deleteMask', event)">üóëÔ∏è Delete Mask</div>
        </div>
    </div>

    <!-- ArtNet Output Context Menu -->
    <div id="outputContextMenu" class="context-menu">
        <div class="context-menu-item" onclick="app.outputContextMenuAction('preview', event)">üìä DMX Monitor</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" onclick="app.outputContextMenuAction('edit', event)">‚úèÔ∏è Edit Output</div>
        <div class="context-menu-item" onclick="app.outputContextMenuAction('delete', event)">üóëÔ∏è Delete Output</div>
    </div>

    <!-- Bootstrap JS -->
    <script src="libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    
    <!-- Socket.IO Client -->
    <script src="libs/socket.io.min.js"></script>
    
    <!-- Main Script -->
    <script src="js/output-settings.js"></script>
</body>
</html>
