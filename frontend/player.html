<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player - Flux</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/css/ion.rangeSlider.min.css"/>
    <link href="css/styles.css" rel="stylesheet">
    <link href="css/triple-slider.css" rel="stylesheet">
    <link href="css/player.css" rel="stylesheet">
    <link href="css/tab-components.css" rel="stylesheet">
    <link href="css/thumbnails.css" rel="stylesheet">
</head>
<body>
    <script src="js/menu-loader.js"></script>
    <script src="js/transition-menu-loader.js"></script>
    <script src="js/modal-loader.js"></script>
    <script src="js/search-filter-loader.js"></script>
    
    <div class="app-layout">
        <!-- Global Playlist Controls -->
        <div class="playlist-management-bar">
            <div class="playlist-management-bar-title">
                <span>üìã Playlist Management</span>
            </div>
            <div class="playlist-management-bar-actions">
                <button class="btn btn-success btn-sm" onclick="savePlaylists()" title="Save Both Playlists">üíæ Save Playlists</button>
                <button class="btn btn-primary btn-sm" onclick="saveSnapshot()" title="Create Snapshot">üì∏ Snapshot</button>
                <button class="btn btn-info btn-sm" onclick="loadPlaylists()" title="Load Both Playlists">üìÇ Load Playlists</button>
                <button class="btn btn-warning btn-sm" onclick="loadSnapshotModal()" title="Load Snapshot">üîÑ Restore</button>
                <button class="btn btn-outline-secondary btn-sm" id="sequencerModeBtn" onclick="toggleSequencerMode()" title="Toggle Sequencer Mode">üéµ Sequencer Mode</button>
            </div>
        </div>
        
        <!-- Waveform Analyzer Section -->
        <div class="waveform-analyzer-section">
            <!-- Preview Box -->
            <div class="preview-box-waveform">
                <div class="preview-area-waveform" onclick="document.getElementById('audioFileInput').click()">
                    <span>üìä Drag & Drop MP3<br>or Click to Browse</span>
                </div>
                <div class="file-info-waveform" id="waveformFileInfo">No file loaded</div>
                
                <!-- Controls -->
                <div class="controls-waveform">
                    <input type="file" id="audioFileInput" accept="audio/*" style="display: none;">
                    <button class="btn btn-sm btn-outline-secondary" id="playBtn" disabled title="Play">‚ñ∂Ô∏è</button>
                    <button class="btn btn-sm btn-warning" id="pauseBtn" disabled title="Pause">‚è∏Ô∏è</button>
                    <button class="btn btn-sm btn-danger" id="stopBtn" disabled title="Stop">‚èπÔ∏è</button>
                    <button class="btn btn-sm btn-outline-danger" id="clearSplitsBtn" disabled title="Clear All Splits">üóëÔ∏è</button>
                    <button class="btn btn-sm btn-outline-secondary" id="minifyBtn" title="Minify">‚¨áÔ∏è</button>
                </div>
            </div>
            
            <!-- Spacer -->
            <div class="waveform-spacer"></div>
            
            <!-- Waveform & Playlist Area -->
            <div class="playlist-waveform-area">
                <!-- Waveform -->
                <div class="waveform-container">
                    <div id="waveform"></div>
                    <div class="waveform-help">
                        üí° <strong>Click</strong> on waveform to add split | <strong>Right-click</strong> region to remove | <strong>Click slot</strong> to loop
                    </div>
                    <div class="playback-info" style="margin-top: 8px;">
                        <span><strong>Time:</strong> <span id="currentTime">0:00</span> / <span id="duration">0:00</span></span>
                        <span style="margin-left: 12px;"><strong>Slot:</strong> <span id="currentSlot" class="info-badge">None</span></span>
                    </div>
                </div>
                
                <!-- Slots Playlist -->
                <div class="slots-container" id="slotsContainer">
                    <div id="slotsList"></div>
                </div>
            </div>
        </div>
        
        <!-- Video Player Section -->
        <div class="player-section">
            <!-- Preview -->
            <div class="preview-box">
                <div class="preview-video" id="videoPreview" onclick="openVideoFullscreen()" title="Click to open fullscreen">
                    <canvas id="videoPreviewVideo" style="width: 100%; height: 100%; object-fit: contain; display: none;"></canvas>
                    <img src="" alt="Video Preview" id="videoPreviewImg" style="width: 100%; height: 100%; object-fit: contain;" decoding="async" loading="eager">
                </div>
                <div class="player-controls">
                    <button class="btn btn-secondary btn-sm" onclick="previous('video')" title="Previous Video">‚èÆÔ∏è</button>
                    <button class="btn btn-success btn-sm" onclick="play('video')" title="Play / Restart">‚ñ∂Ô∏è</button>
                    <button class="btn btn-warning btn-sm" onclick="pause('video')">‚è∏Ô∏è</button>
                    <button class="btn btn-danger btn-sm" onclick="stop('video')">‚èπÔ∏è</button>
                    <button class="btn btn-secondary btn-sm" onclick="next('video')" title="Next Video">‚è≠Ô∏è</button>
                    <button class="btn btn-outline-primary btn-sm" id="videoAutoplayBtn" onclick="toggleAutoplay('video')" title="Autoplay">üîÅ</button>
                    <button class="btn btn-outline-primary btn-sm" id="videoLoopBtn" onclick="toggleLoop('video')" title="Loop Playlist">üîÇ</button>
                </div>
            </div>
            
            <!-- Transition Menu (dynamically loaded) -->
            <div id="videoTransitionMenuContainer"></div>
            
            <!-- Playlist -->
            <div class="playlist-area">
                <div class="playlist-header" id="videoPlaylistHeader">
                    <span>üìπ Video Playlist</span>
                    <div class="master-toggle">
                        <label class="master-switch">
                            <input type="checkbox" id="videoMasterSwitch" onchange="toggleMasterPlaylist('video')">
                            <span class="master-slider"></span>
                        </label>
                        <span class="master-label" id="videoMasterLabel">Master</span>
                    </div>
                </div>
                <div class="playlist-scroll" id="videoPlaylist">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÇ</div>
                        <p>No videos loaded</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Art-Net Player Section -->
        <div class="player-section">
            <!-- Preview -->
            <div class="preview-box">
                <div class="preview-video" id="artnetPreview">
                    <canvas id="artnetPreviewVideo" style="width: 100%; height: 100%; object-fit: contain; display: none;"></canvas>
                    <img src="" alt="Art-Net Preview" id="artnetPreviewImg" style="width: 100%; height: 100%; object-fit: contain;" decoding="async" loading="eager">
                </div>
                <div class="player-controls">
                    <button class="btn btn-secondary btn-sm" onclick="previous('artnet')" title="Previous Video">‚èÆÔ∏è</button>
                    <button class="btn btn-success btn-sm" onclick="play('artnet')" title="Play / Restart">‚ñ∂Ô∏è</button>
                    <button class="btn btn-warning btn-sm" onclick="pause('artnet')">‚è∏Ô∏è</button>
                    <button class="btn btn-danger btn-sm" onclick="stop('artnet')">‚èπÔ∏è</button>
                    <button class="btn btn-secondary btn-sm" onclick="next('artnet')" title="Next Generator">‚è≠Ô∏è</button>
                    <button class="btn btn-outline-primary btn-sm" id="artnetAutoplayBtn" onclick="toggleAutoplay('artnet')" title="Autoplay">üîÅ</button>
                    <button class="btn btn-outline-primary btn-sm" id="artnetLoopBtn" onclick="toggleLoop('artnet')" title="Loop Playlist">üîÇ</button>
                </div>
            </div>
            
            <!-- Transition Menu (dynamically loaded) -->
            <div id="artnetTransitionMenuContainer"></div>
            
            <!-- Playlist -->
            <div class="playlist-area">
                <div class="playlist-header" id="artnetPlaylistHeader">
                    <span>üé® Art-Net Generator Playlist</span>
                    <div class="master-toggle">
                        <label class="master-switch">
                            <input type="checkbox" id="artnetMasterSwitch" onchange="toggleMasterPlaylist('artnet')">
                            <span class="master-slider"></span>
                        </label>
                        <span class="master-label" id="artnetMasterLabel">Master</span>
                    </div>
                </div>
                <div class="playlist-scroll" id="artnetPlaylist">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÇ</div>
                        <p>No Art-Net sources loaded</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Section: Tabs + FX Controls -->
        <div class="bottom-section">
            <!-- Left Tabs Panel -->
            <div class="tabs-panel">
                <div class="tabs-header">
                    <button class="tab-btn" onclick="switchTab('effects')">Effects</button>
                    <button class="tab-btn" onclick="switchTab('sources')">Sources</button>
                    <button class="tab-btn active" onclick="switchTab('files')">Files</button>
                </div>
                <div class="tab-content">
                    <!-- Effects Tab -->
                    <div class="tab-pane" id="tab-effects">
                        <h6>Available Effects</h6>
                        <div id="effectsSearchContainer"></div>
                        <div id="availableEffects">
                            <div class="empty-state">
                                <div class="spinner-border text-primary" role="status"></div>
                                <p class="mt-2">Loading...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sources Tab -->
                    <div class="tab-pane" id="tab-sources">
                        <h6>Available Sources</h6>
                        <div id="sourcesSearchContainer"></div>
                        <div id="availableSources">
                            <div class="empty-state">
                                <p>Coming soon...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Files Tab -->
                    <div class="tab-pane active" id="tab-files">
                        <h6>File Browser</h6>
                        <div id="filesSearchContainer"></div>
                        <div id="fileBrowser">
                            <div class="empty-state">
                                <p>Coming soon...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Layer Management Panel -->
            <div class="fx-panel" id="layerManagementPanel">
                <div class="fx-panel-header">
                    <span id="layerPanelTitle">üéûÔ∏è Layers</span>
                </div>
                <div class="fx-panel-body" id="layerPanelContent">
                    <div class="empty-state">
                        <p class="empty-state-hint">Ctrl+Linksklick auf Clip um Layer zu aktivieren</p>
                    </div>
                </div>
            </div>
            
            <!-- Video FX Control -->
            <div class="fx-panel">
                <div class="fx-panel-header">
                    <span>üé¨ Video FX</span>
                    <button class="btn btn-sm btn-danger btn-icon" onclick="clearVideoEffects()">üóëÔ∏è</button>
                </div>
                <div class="fx-panel-body" id="videoFxList">
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ú®</div>
                        <h6>No Effects</h6>
                        <p>Add effects from the left panel</p>
                    </div>
                </div>
            </div>
            
            <!-- Art-Net FX Control -->
            <div class="fx-panel">
                <div class="fx-panel-header">
                    <span>üí° Art-Net FX</span>
                    <button class="btn btn-sm btn-danger btn-icon" onclick="clearArtnetEffects()">üóëÔ∏è</button>
                </div>
                <div class="fx-panel-body" id="artnetFxList">
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ú®</div>
                        <h6>No Effects</h6>
                        <p>Add effects from the left panel</p>
                    </div>
                </div>
            </div>
            
            <!-- Clip FX Control (Unified for both players) -->
            <div class="fx-panel">
                <div class="fx-panel-header">
                    <span id="clipFxTitle">üé¨ Clip FX</span>
                    <button class="btn btn-sm btn-danger btn-icon" onclick="clearClipEffects()">üóëÔ∏è</button>
                </div>
                <div class="fx-panel-body" id="clipFxList">
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ú®</div>
                        <h6>No Clip Effects</h6>
                        <p>Select a clip to manage effects</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Component -->
    <script src="js/toast-loader.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/js/ion.rangeSlider.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="js/triple-slider.js"></script>
    <script src="js/player.js" type="module"></script>
    <script type="module" src="js/waveform-analyzer.js"></script>
    <script>
        // Sequencer Mode Toggle
        let sequencerModeActive = false;
        
        function toggleSequencerMode() {
            sequencerModeActive = !sequencerModeActive;
            const waveformSection = document.querySelector('.waveform-analyzer-section');
            const btn = document.getElementById('sequencerModeBtn');
            
            if (sequencerModeActive) {
                waveformSection.style.display = 'none';
                btn.classList.remove('btn-outline-secondary');
                btn.classList.add('btn-success');
                btn.textContent = 'üéµ Sequencer: ON';
            } else {
                waveformSection.style.display = 'grid';
                btn.classList.remove('btn-success');
                btn.classList.add('btn-outline-secondary');
                btn.textContent = 'üéµ Sequencer Mode';
            }
        }
    </script>
</body>
</html>