<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>3D Room â€“ Add & Position Boxes</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        font-family: sans-serif;
        background: #111;
    }
    #ui {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 10;
    }
    button {
        padding: 8px 12px;
        font-size: 14px;
        cursor: pointer;
    }
</style>
</head>
<body>

<div id="ui">
    <button id="addBox">Add Box</button>
</div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160/build/three.module.js";
import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.160/examples/jsm/controls/OrbitControls.js";
import { TransformControls } from "https://cdn.jsdelivr.net/npm/three@0.160/examples/jsm/controls/TransformControls.js";

let scene, camera, renderer;
let orbitControls, transformControls;
let raycaster = new THREE.Raycaster();
let mouse = new THREE.Vector2();
let selectedObject = null;

init();
animate();

function init() {
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x202020);

    camera = new THREE.PerspectiveCamera(
        60,
        window.innerWidth / window.innerHeight,
        0.1,
        100
    );
    camera.position.set(6, 5, 8);

    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lights
    scene.add(new THREE.AmbientLight(0xffffff, 0.4));
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(5, 10, 7);
    scene.add(dirLight);

    // Orbit controls
    orbitControls = new OrbitControls(camera, renderer.domElement);

    // Transform controls
    transformControls = new TransformControls(camera, renderer.domElement);
    transformControls.addEventListener("dragging-changed", e => {
        orbitControls.enabled = !e.value;
    });
    scene.add(transformControls);

    // Room
    createRoom();

    // Events
    window.addEventListener("resize", onResize);
    renderer.domElement.addEventListener("pointerdown", onPointerDown);
    document.getElementById("addBox").addEventListener("click", addBox);
    window.addEventListener("keydown", onKeyDown);
}

function createRoom() {
    const roomSize = 10;
    const wallMat = new THREE.MeshStandardMaterial({
        color: 0x444444,
        side: THREE.BackSide
    });

    const room = new THREE.Mesh(
        new THREE.BoxGeometry(roomSize, roomSize, roomSize),
        wallMat
    );
    room.position.y = roomSize / 2;
    scene.add(room);

    const grid = new THREE.GridHelper(roomSize, 10);
    scene.add(grid);
}

function addBox() {
    const geo = new THREE.BoxGeometry(1, 1, 1);
    const mat = new THREE.MeshStandardMaterial({
        color: Math.random() * 0xffffff
    });
    const box = new THREE.Mesh(geo, mat);
    box.position.set(0, 0.5, 0);
    scene.add(box);
    selectObject(box);
}

function onPointerDown(event) {
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObjects(scene.children, false);

    if (intersects.length > 0) {
        const obj = intersects[0].object;
        if (obj !== transformControls.object) {
            selectObject(obj);
        }
    }
}

function selectObject(object) {
    selectedObject = object;
    transformControls.attach(object);
}

function onKeyDown(e) {
    if (!selectedObject) return;

    switch (e.key.toLowerCase()) {
        case "w":
            transformControls.setMode("translate");
            break;
        case "e":
            transformControls.setMode("rotate");
            break;
        case "r":
            transformControls.setMode("scale");
            break;
        case "delete":
            scene.remove(selectedObject);
            transformControls.detach();
            selectedObject = null;
            break;
    }
}

function onResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
}
</script>

</body>
</html>
